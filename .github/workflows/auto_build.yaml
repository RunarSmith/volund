name: Parallel and Sequential Jobs Example

on:
  push:
    branches: [ main ] # Ou tout autre d√©clencheur voulu

jobs:

  # --- Base -----------------------------------------

  base-arch:
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "base-arch"
          base_distrib: "arch"
          image_role: "base"
          image_version: "0.1.0"

  base-blackarch:
    runs-on: windows-2025
    needs: base-arch
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "base-blackarch"
          base_distrib: "blackarch"
          image_role: "base"
          image_version: "0.1.0"

  base-debian:
    runs-on: windows-2025
    needs: base-arch
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "base-debian"
          base_distrib: "debian"
          image_role: "base"
          image_version: "0.1.0"

  base-fedora:
    runs-on: windows-2025
    needs: base-arch
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "base-fedora"
          base_distrib: "fedora"
          image_role: "base"
          image_version: "0.1.0"

  base-kali:
    runs-on: windows-2025
    needs: base-arch
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "base-kali"
          base_distrib: "kali"
          image_role: "base"
          image_version: "0.1.0"

  base-parrot:
    runs-on: windows-2025
    needs: base-arch
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "base-parrot"
          base_distrib: "parrot"
          image_role: "base"
          image_version: "0.1.0"

  # --- RDV -----------------------------------------
  
  base_rdv:
    runs-on: ubuntu-latest
    needs:
      - base-arch
      - base-blackarch
      - base-debian
      - base-fedora
      - base-kali
      - base-parrot
    steps:
      - run: echo "RDV base image built successfully"
        shell: bash

  # --- DevSecOps -----------------------------------------

  devsecops-arch:
    needs: base_rdv
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "devsecops-arch"
          base_distrib: "arch"
          image_role: "devsecops"
          image_version: "0.1.0"

  devsecops-debian:
    needs: 
      - base_rdv
      - devsecops-arch
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "devsecops-debian"
          base_distrib: "debian"
          image_role: "devsecops"
          image_version: "0.1.0"

  devsecops-fedora:
    needs: 
      - base_rdv
      - devsecops-arch
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "devsecops-fedora"
          base_distrib: "fedora"
          image_role: "devsecops"
          image_version: "0.1.0"

  # --- RDV -----------------------------------------
  
  devsecops_rdv:
    runs-on: ubuntu-latest
    needs:
      - devsecops-arch
      - devsecops-debian
      - devsecops-fedora
    steps:
      - run: echo "RDV base image built successfully"
        shell: bash

  # --- OffSec -----------------------------------------

  offsec-arch:
    needs: devsecops_rdv
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "offsec-arch"
          base_distrib: "arch"
          image_role: "offsec"
          image_version: "0.1.0"

  offsec-debian:
    needs: 
      - devsecops_rdv
      - offsec-arch
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "offsec-debian"
          base_distrib: "debian"
          image_role: "offsec"
          image_version: "0.1.0"

  offsec-fedora:
    needs: 
      - devsecops_rdv
      - offsec-arch
    runs-on: windows-2025
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/vol_build_image
        with:
          image_name: "offsec-fedora"
          base_distrib: "fedora"
          image_role: "offsec"
          image_version: "0.1.0"
